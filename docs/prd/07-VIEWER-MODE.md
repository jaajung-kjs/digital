# F07: 뷰어 모드 - 상세 PRD

## 1. 개요

### 1.1 기능 ID
**F07-VIEWER-MODE**

### 1.2 기능 설명
일반 사용자를 위한 읽기 전용 뷰어. 평면도, 랙 상세, 설비 정보, 배선도를 조회하고 필터링/하이라이트 기능을 사용할 수 있다. 편집 기능은 제공하지 않는다.

### 1.3 우선순위
**P1** (중요)

---

## 2. 요구사항

### 2.1 기능 요구사항

#### FR-01: 평면도 뷰어
| 항목 | 내용 |
|------|------|
| 보기 | 평면도 전체 보기 |
| 탐색 | 줌, 팬 |
| 케이블 | 케이블 경로 표시 |
| 필터 | 케이블 종류별 필터 |

#### FR-02: 랙 뷰어
| 항목 | 내용 |
|------|------|
| 정면도 | 랙 정면도 보기 |
| 설비 목록 | 설비 클릭으로 상세 보기 |
| 사진 | 랙 정면/후면 사진 보기 |

#### FR-03: 설비 상세 보기
| 항목 | 내용 |
|------|------|
| 기본 정보 | 이름, 모델, 시리얼 등 |
| 포트 목록 | 포트 및 연결 상태 |
| 연결 현황 | 연결된 장비 목록 |

#### FR-04: 연결 하이라이트
| 항목 | 내용 |
|------|------|
| 설비 선택 | 클릭으로 설비 선택 |
| 연결 표시 | 선택 설비의 연결된 케이블/장비 하이라이트 |
| 필터 적용 | 하이라이트에도 필터 적용 |

#### FR-05: 빠른 탐색
| 항목 | 내용 |
|------|------|
| 브레드크럼 | 현재 위치 표시 및 탐색 |
| 연결 장비 이동 | 연결된 장비 클릭 시 해당 위치로 이동 |

### 2.2 비기능 요구사항

| 항목 | 요구사항 |
|------|----------|
| 로딩 시간 | < 2초 |
| 줌/팬 | 부드러운 동작 |
| 반응성 | 클릭 응답 < 200ms |

---

## 3. 뷰어 vs 에디터 비교

### 3.1 기능 비교
| 기능 | 뷰어 (viewer) | 에디터 (admin) |
|------|---------------|----------------|
| 평면도 보기 | ✓ | ✓ |
| 줌/팬 | ✓ | ✓ |
| 케이블 필터링 | ✓ | ✓ |
| 연결 하이라이트 | ✓ | ✓ |
| 랙 상세 보기 | ✓ | ✓ |
| 설비 정보 보기 | ✓ | ✓ |
| 사진 보기 | ✓ | ✓ |
| 구조물 편집 | ✗ | ✓ |
| 랙 배치/이동 | ✗ | ✓ |
| 설비 편집 | ✗ | ✓ |
| 케이블 편집 | ✗ | ✓ |
| 사진 업로드 | ✗ | ✓ |

### 3.2 UI 차이점
- 뷰어: 도구 모음 숨김, 편집 버튼 없음
- 뷰어: 속성 패널은 읽기 전용
- 뷰어: 우클릭 메뉴 단순화

---

## 4. 화면 설계

### 4.1 평면도 뷰어 (S04)
```
┌─────────────────────────────────────────────────────────────────────────────────┐
│ 🏢 서울 변전소 > B1층 ICT실                    [에디터 모드] (관리자만 표시)      │
├─────────┬───────────────────────────────────────────────────────────────────────┤
│         │                                                                       │
│ 필터    │                         평면도 뷰어                                    │
│         │     ┌─────────────────────────────────────────────────────┐           │
│ 케이블  │     │  ═══════════════════════════════════════════        │           │
│ ☑ AC    │     │  ║                                         ║        │           │
│ ☑ DC    │     │  ║   ┌──────┐  ┌──────┐  ┌──────┐         ║        │           │
│ ☑ LAN   │     │  ║   │RACK  │══│RACK  │──│RACK  │         ║        │           │
│ ☑ 광    │     │  ║   │ A01  │  │ A02  │  │ A03  │         ║        │           │
│         │     │  ║   └──────┘  └──────┘  └──────┘         ║        │           │
│ [전체]  │     │  ║       │                                 ║        │           │
│ [해제]  │     │  ║       ╚═══════════╗                     ║        │           │
│         │     │  ║   ┌──────┐  ┌─────╨┐  ┌──────┐         ║        │           │
│ ─────── │     │  ║   │RACK  │  │ PDU  │  │RACK  │         ║        │           │
│         │     │  ║   │ B01  │──│      │  │ B03  │         ║        │           │
│ 정보    │     │  ║   └──────┘  └──────┘  └──────┘         ║        │           │
│         │     │  ═══════════════════════════════════════════        │           │
│ 랙: 6개 │     └─────────────────────────────────────────────────────┘           │
│ 설비:32 │                                                                       │
│ 케이블: │     줌: 100%  |  💡 랙 클릭시 상세 보기                                │
│  45개   │                                                                       │
│         │                                                                       │
├─────────┴───────────────────────────────────────────────────────────────────────┤
│ 선택: RACK-A01 (메인 서버 랙) | 설비 12개 | AC 2, LAN 8, 광 2      [상세 보기]   │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 4.2 랙 상세 뷰어 (S06)
```
┌─────────────────────────────────────────────────────────────────────────────────┐
│ 🏢 서울 > B1층 > RACK-A01                                   [← 평면도] [사진]   │
├───────────────────────────────────────────┬─────────────────────────────────────┤
│                                           │                                     │
│   랙 정면도 (42U)                          │   랙 정보                           │
│                                           │                                     │
│   42 ├─────────────────────────┤          │   이름: RACK-A01                    │
│   41 ├                         ┤          │   위치: 메인 서버실                 │
│   40 │                         │          │   총 U: 42                          │
│   39 │      서버 #1 (4U)       │◀─클릭    │   사용: 28U (67%)                   │
│   38 │      Dell R740         │          │                                     │
│   37 │                         │          │   ─────────────────────────         │
│   36 ├─────────────────────────┤          │                                     │
│   35 │      서버 #2 (2U)       │          │   선택된 설비                        │
│   34 │                         │          │                                     │
│   33 ├─────────────────────────┤          │   📦 서버 #1                         │
│   32 │      스위치 #1 (1U)     │          │   모델: Dell R740                   │
│   31 ├─────────────────────────┤          │   위치: 38U~41U (4U)                │
│   .. │                         │          │   담당자: 홍길동                    │
│    3 ├                         ┤          │                                     │
│    2 │        PDU (2U)        │          │   연결:                              │
│    1 │                         │          │   ├ eth0 → Switch/port24           │
│      └─────────────────────────┘          │   ├ eth1 → (미연결)                │
│                                           │   ├ pwr1 → PDU-A/outlet1           │
│   💡 설비 클릭시 상세 정보                 │   └ pwr2 → PDU-B/outlet1           │
│                                           │                                     │
│                                           │   [포트 상세] [연결 현황]            │
└───────────────────────────────────────────┴─────────────────────────────────────┘
```

### 4.3 사진 뷰어
```
┌─────────────────────────────────────────────────────────────┐
│ 📷 RACK-A01 사진                                       [X]  │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   [정면]  [후면]                                            │
│                                                             │
│   ┌─────────────────────────────────────────────────────┐   │
│   │                                                     │   │
│   │                                                     │   │
│   │                   (실제 사진)                        │   │
│   │                                                     │   │
│   │                                                     │   │
│   │                                                     │   │
│   │                                                     │   │
│   └─────────────────────────────────────────────────────┘   │
│                                                             │
│                      [확대] [축소] [원본]                    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 4.4 연결 하이라이트 상태
```
설비 클릭 시:

┌─────────────────────────────────────────────────────────────┐
│                                                             │
│     ┌──────┐                              ┌──────┐         │
│     │▓▓▓▓▓▓│══════════════════════════════│░░░░░░│         │
│     │서버#1│──────────────────────────────│Switch│         │
│     │▓▓▓▓▓▓│══════════════════════════════│░░░░░░│         │
│     └──────┘                              └──────┘         │
│         ║                                                   │
│         ║    ┌──────┐                                       │
│         ╚════│░░░░░░│                                       │
│              │ PDU  │                                       │
│              └──────┘                                       │
│                                                             │
│  ▓▓ 선택된 설비                                             │
│  ░░ 연결된 설비                                             │
│  ══ AC 전원 연결                                            │
│  ── LAN 연결                                                │
│                                                             │
│  연결된 장비: Switch (RACK-B01), PDU (RACK-A01)             │
│  케이블: AC 2개, LAN 2개                                    │
│                                                             │
│  💡 연결된 장비를 클릭하면 해당 위치로 이동합니다            │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 4.5 설비 상세 정보 패널
```
┌─────────────────────────────────────────────┐
│ 📦 서버 #1                             [X]  │
├─────────────────────────────────────────────┤
│                                             │
│ 기본 정보                                   │
│ ─────────────────────────────               │
│ 모델: Dell R740                             │
│ 제조사: Dell                                │
│ 시리얼: ABC123456                           │
│                                             │
│ 설치 정보                                   │
│ ─────────────────────────────               │
│ 위치: RACK-A01 / 38U~41U (4U)              │
│ 설치일: 2024-01-15                          │
│ 담당자: 홍길동                              │
│                                             │
│ 포트 현황 (8개)                             │
│ ─────────────────────────────               │
│ ├ LAN eth0    ● Switch/port24              │
│ ├ LAN eth1    ○ 미연결                     │
│ ├ LAN eth2    ○ 미연결                     │
│ ├ LAN eth3    ○ 미연결                     │
│ ├ LAN ipmi    ● MgmtSW/port1               │
│ ├ AC  pwr1    ● PDU-A/outlet1              │
│ └ AC  pwr2    ● PDU-B/outlet1              │
│                                             │
│ 설명                                        │
│ ─────────────────────────────               │
│ 메인 웹 서버                                │
│                                             │
├─────────────────────────────────────────────┤
│        [연결 추적]  [닫기]                   │
└─────────────────────────────────────────────┘
```

---

## 5. 탐색 흐름

### 5.1 메인 탐색 흐름
```
대시보드 (변전소 목록)
    │
    ├─ 변전소 카드 클릭
    │
    ▼
층 목록
    │
    ├─ "평면도 보기" 클릭
    │
    ▼
평면도 뷰어
    │
    ├─ 랙 클릭
    │
    ▼
랙 상세 뷰어
    │
    ├─ 설비 클릭
    │
    ▼
설비 상세 패널
    │
    ├─ 연결 장비 클릭
    │
    ▼
해당 장비로 이동 (랙 또는 평면도)
```

### 5.2 브레드크럼 탐색
```
🏢 서울 변전소 > B1층 ICT실 > RACK-A01 > 서버 #1

각 단계 클릭 시 해당 화면으로 이동
```

### 5.3 연결 장비 이동
```
서버 #1 상세 패널에서:

연결: eth0 → Switch/port24 (RACK-B01)
                    ↑
                   클릭

→ RACK-B01 상세 뷰어로 이동
→ Switch 설비 자동 선택
```

---

## 6. 필터링 동작

### 6.1 케이블 타입 필터
```
초기 상태: 모두 선택

☑ AC (20개)    → 빨간 케이블 표시
☑ DC (5개)     → 주황 케이블 표시
☑ LAN (15개)   → 파란 케이블 표시
☑ 광 (5개)     → 초록 케이블 표시

AC 해제 시:
☐ AC (20개)    → AC 케이블 숨김
☑ DC (5개)
☑ LAN (15개)
☑ 광 (5개)
```

### 6.2 하이라이트와 필터 조합
```
상황: LAN만 필터 선택, 설비 클릭

결과:
- 해당 설비의 LAN 연결만 하이라이트
- AC, DC, 광 연결은 표시 안 됨
- 연결된 장비 중 LAN으로 연결된 것만 하이라이트
```

---

## 7. 권한 처리

### 7.1 뷰어 권한 (viewer)
- 모든 읽기 작업 허용
- 편집 버튼/메뉴 숨김 처리
- 편집 API 호출 시 403 응답

### 7.2 관리자 권한 (admin)
- 뷰어 모드 접근 가능
- "에디터 모드" 전환 버튼 표시
- 에디터 모드로 전환 가능

---

## 8. 테스트 케이스

### TC-01: 평면도 뷰어 접근
1. 일반 사용자 로그인
2. 변전소 → 층 → 평면도 접근
3. **Expected**: 평면도 표시, 편집 버튼 없음

### TC-02: 케이블 필터링
1. 평면도 뷰어에서 AC 체크 해제
2. **Expected**: AC 케이블만 숨김

### TC-03: 랙 클릭 → 상세 보기
1. 평면도에서 랙 클릭
2. **Expected**: 랙 상세 뷰어 표시

### TC-04: 설비 연결 하이라이트
1. 평면도에서 설비가 있는 랙 선택
2. **Expected**: 연결된 케이블과 장비 하이라이트

### TC-05: 연결 장비 이동
1. 설비 상세에서 연결된 장비 클릭
2. **Expected**: 해당 랙으로 이동, 설비 선택

### TC-06: 사진 보기
1. 랙 상세에서 "사진" 버튼 클릭
2. **Expected**: 정면/후면 사진 표시

### TC-07: 뷰어 권한 검증
1. 일반 사용자로 편집 API 호출 시도
2. **Expected**: 403 Forbidden 응답
